#!/usr/bin/env bash

if ! command -v "stow" > /dev/null; then
	>&2 echo "Command stow not found, aborting"
	exit 1
fi

export __DOTS_DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )/../" && pwd )"

cat <<-EOF > "$__DOTS_DIR/shell/.bash_profile"
	# this file is auto generated by a script, modifications will be overwritten
	[ -n "\$PS1" ] && source "$__DOTS_DIR/dots.bash"
EOF

stow_args="--verbose=1 --target $HOME --dir $__DOTS_DIR/"

__DOTS_STOW_DRY_RUN="${__DOTS_STOW_DRY_RUN:-false}"
if ( ${__DOTS_STOW_DRY_RUN} ); then
	stow_args="$stow_args --simulate"
fi

# create directories that will contain symlinks
mkdir -p "$__DOTS_DIR/config/.config/terminator/plugins"
mkdir -p "$__DOTS_DIR/config/.local/share/gnome-shell/extensions/"

# create directories in HOME that should be directories and not symlinks
mkdir -p "$HOME/.dropbox/"

ln -sfn "$__DOTS_DIR/dependencies/diff-so-fancy/diff-so-fancy" "$__DOTS_DIR/bin/.bin/diff-so-fancy"
ln -sfn "$__DOTS_DIR/dependencies/gnome-shell-audio-output-switcher" "$__DOTS_DIR/config/.local/share/gnome-shell/extensions/gnome-shell-audio-output-switcher@kgaut"
ln -sfn "$__DOTS_DIR/dependencies/multi-monitors-add-on/multi-monitors-add-on@spin83" "$__DOTS_DIR/config/.local/share/gnome-shell/extensions/multi-monitors-add-on@spin83"
ln -sfn "$__DOTS_DIR/dependencies/ide-sync/ide-sync.sh" "$__DOTS_DIR/bin/.bin/ide-sync"
ln -sfn "$__DOTS_DIR/dependencies/terminator-editor-plugin/editor_plugin.py" "$__DOTS_DIR/config/.config/terminator/plugins/editor_plugin.py"

stow ${stow_args} config
stow ${stow_args} bin
stow ${stow_args} git
stow ${stow_args} shell

# just make sure this file exists
touch "$HOME/.gitconfig_local"

./scripts/gnome-settings.bash

echo "Install complete"
